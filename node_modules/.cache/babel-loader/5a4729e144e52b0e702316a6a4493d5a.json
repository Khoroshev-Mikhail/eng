{"ast":null,"code":"import { createAsyncThunk, createSlice } from '@reduxjs/toolkit';\nimport { setUserToLocalStorage } from '../fns';\nconst user = {\n  id: 0,\n  user_login: null,\n  user_name: null,\n  email: null,\n  token: null,\n  refresh_token: null,\n  jwtExpire: null\n};\nexport const loginThunk = createAsyncThunk('loginThunk', async function (obj) {\n  const response = await fetch('http://localhost:3002/auth', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json;charset=utf-8'\n    },\n    body: JSON.stringify({\n      password: obj.password,\n      login: obj.login\n    })\n  });\n  const user = await response.json();\n  if (response.ok) {\n    setUserToLocalStorage(user);\n  }\n  const {\n    id,\n    user_login,\n    email,\n    user_name,\n    jwtExpire\n  } = user;\n  return {\n    id,\n    user_login,\n    email,\n    user_name,\n    jwtExpire\n  };\n});\nexport const loginByRefreshThunk = createAsyncThunk('loginByRefreshThunk', async function () {\n  const response = await fetch('http://localhost:3002/authByRefreshToken', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json;charset=utf-8'\n    },\n    body: JSON.stringify({\n      refreshToken: localStorage.getItem('refreshToken')\n    })\n  });\n  const data = await response.json();\n  if (response.ok) {\n    localStorage.setItem('id', data.id);\n    localStorage.setItem('login', data.login);\n    localStorage.setItem('token', data.token);\n    localStorage.setItem('refreshToken', data.refreshToken);\n    localStorage.setItem('jwtExpire', data.jwtExpire); //Изменить на нижнее подчеркивание\n  }\n  //Наверно здесь if как-то криво\n  const {\n    id,\n    user_login,\n    email,\n    user_name,\n    jwtExpire\n  } = data;\n  return {\n    id,\n    user_login,\n    email,\n    user_name,\n    jwtExpire\n  };\n});\nexport const exitThunk = createAsyncThunk('exitThunk', async function () {\n  const response = await fetch(`http://localhost:3002/logout/${localStorage.getItem('id')}`); //Обратиться с стейт напрямую, и взять оттуда id\n  const data = await response.json();\n  if (response.ok) {\n    localStorage.removeItem('id');\n    localStorage.removeItem('login');\n    localStorage.removeItem('token');\n    localStorage.removeItem('refreshToken');\n    localStorage.removeItem('jwtExpire');\n  }\n  return data;\n});\nexport const userSlice = createSlice({\n  name: 'userSlice',\n  initialState: user,\n  reducers: {},\n  extraReducers: builder => {\n    builder.addCase(loginThunk.fulfilled, (_, action) => action.payload);\n    builder.addCase(loginByRefreshThunk.fulfilled, (_, action) => action.payload); //Нужен ли здесь addCase с rejeted\n    builder.addCase(loginThunk.rejected, (_, __) => {\n      localStorage.removeItem('id');\n      localStorage.removeItem('login');\n      localStorage.removeItem('token');\n      localStorage.removeItem('refreshToken');\n      localStorage.removeItem('jwtExpire');\n      return user; //попробуй this.initialState или чтото вроде того\n    });\n\n    builder.addCase(exitThunk.fulfilled, (_, action) => user); //попробуй this.initialState\n  }\n});","map":{"version":3,"names":["createAsyncThunk","createSlice","setUserToLocalStorage","user","id","user_login","user_name","email","token","refresh_token","jwtExpire","loginThunk","obj","response","fetch","method","headers","body","JSON","stringify","password","login","json","ok","loginByRefreshThunk","refreshToken","localStorage","getItem","data","setItem","exitThunk","removeItem","userSlice","name","initialState","reducers","extraReducers","builder","addCase","fulfilled","_","action","payload","rejected","__"],"sources":["/Users/tatanaarhipova/MikeIT/eng/src/app/API/userAPI.tsx"],"sourcesContent":["import { createAsyncThunk, createSlice } from '@reduxjs/toolkit'\nimport { setUserToLocalStorage } from '../fns'\nimport { User } from '../types/types'\n\nconst user: User = { id: 0, user_login: null, user_name: null, email: null, token: null, refresh_token: null, jwtExpire: null }\n\nexport const loginThunk = createAsyncThunk(\n    'loginThunk',\n    async function(obj: any) {\n        const response = await fetch('http://localhost:3002/auth', {\n            method: 'POST',            \n            headers: {\n                'Content-Type': 'application/json;charset=utf-8'\n            }, \n            body: JSON.stringify({password: obj.password, login: obj.login})\n        })\n        const user = await response.json()\n        if(response.ok){\n            setUserToLocalStorage(user)\n        }\n        const { id, user_login, email, user_name, jwtExpire } = user\n        return { id, user_login, email, user_name, jwtExpire }\n    }\n)\nexport const loginByRefreshThunk = createAsyncThunk(\n    'loginByRefreshThunk',\n    async function() {\n        const response = await fetch('http://localhost:3002/authByRefreshToken', {\n            method: 'POST',            \n            headers: {\n                'Content-Type': 'application/json;charset=utf-8'\n            }, \n            body: JSON.stringify({\n                refreshToken: localStorage.getItem('refreshToken')\n            })\n        })\n        const data = await response.json()\n        if(response.ok){\n            localStorage.setItem('id', data.id);\n            localStorage.setItem('login', data.login);\n            localStorage.setItem('token', data.token);\n            localStorage.setItem('refreshToken', data.refreshToken);\n            localStorage.setItem('jwtExpire', data.jwtExpire); //Изменить на нижнее подчеркивание\n        }\n        //Наверно здесь if как-то криво\n        const { id, user_login, email, user_name, jwtExpire } = data\n        return { id, user_login, email, user_name, jwtExpire }\n    }\n)\nexport const exitThunk = createAsyncThunk(\n    'exitThunk',\n    async function() {\n        const response = await fetch(`http://localhost:3002/logout/${localStorage.getItem('id')}`)//Обратиться с стейт напрямую, и взять оттуда id\n        const data = await response.json()\n        if(response.ok){\n            localStorage.removeItem('id')\n            localStorage.removeItem('login')\n            localStorage.removeItem('token')\n            localStorage.removeItem('refreshToken')\n            localStorage.removeItem('jwtExpire')\n        }\n        return data\n    }\n)\n\nexport const userSlice = createSlice({\n    name: 'userSlice',\n    initialState: user,\n    reducers: {},\n    extraReducers: (builder) => {\n        builder.addCase(loginThunk.fulfilled, (_, action) => action.payload)\n        builder.addCase(loginByRefreshThunk.fulfilled, (_, action) => action.payload) //Нужен ли здесь addCase с rejeted\n        builder.addCase(loginThunk.rejected, (_, __) => {\n            localStorage.removeItem('id')\n            localStorage.removeItem('login')\n            localStorage.removeItem('token')\n            localStorage.removeItem('refreshToken')\n            localStorage.removeItem('jwtExpire')\n            return user //попробуй this.initialState или чтото вроде того\n          })\n        builder.addCase(exitThunk.fulfilled, (_, action) => user)//попробуй this.initialState\n    }\n})"],"mappings":"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"},"metadata":{},"sourceType":"module"}